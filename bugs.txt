

# üîß –ü–æ–ª–Ω—ã–π –ø–ª–∞–Ω: –ü–µ—Ä—Å–æ–Ω–∞–∂ + –í—Ä–∞–≥–∏ + –ë–æ–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞

## üêõ –°–Ω–∞—á–∞–ª–∞ ‚Äî —á—Ç–æ —Å–ª–æ–º–∞–Ω–æ –∏ –ø–æ—á–µ–º—É

```
–ë–∞–≥ 1: "–í—Ä–∞–≥–∏ –ª–∏–ø–Ω—É—Ç –∫ –∏–≥—Ä–æ–∫—É"
‚Üí –ù–µ—Ç collision layers. –í—Å–µ –Ω–∞ –æ–¥–Ω–æ–º —Å–ª–æ–µ ‚Äî —Ç–µ–ª–∞ –ø–µ—Ä–µ–∫—Ä—ã–≤–∞—é—Ç—Å—è.
‚Üí –£ –≤—Ä–∞–≥–∞ –Ω–µ—Ç stop_distance ‚Äî –æ–Ω –±–µ—Å–∫–æ–Ω–µ—á–Ω–æ —Ç–æ–ª–∫–∞–µ—Ç—Å—è –≤ –∏–≥—Ä–æ–∫–∞.

–ë–∞–≥ 2: "–ê—Ç–∞–∫–∞ –Ω–µ –Ω–∞–Ω–æ—Å–∏—Ç —É—Ä–æ–Ω"
‚Üí HitboxComponent –∏—â–µ—Ç receive_damage() –Ω–∞ Area2D:
   area.has_method("receive_damage")  ‚Üê FALSE!
   –ü–æ—Ç–æ–º—É —á—Ç–æ receive_damage() –ª–µ–∂–∏—Ç –Ω–∞ –î–û–ß–ï–†–ù–ï–ú Node (HurtboxComponent),
   –∞ –Ω–µ –Ω–∞ —Å–∞–º–æ–π Area2D.

–ë–∞–≥ 3: "HurtboxComponent –Ω–µ –Ω–∞—Ö–æ–¥–∏—Ç HealthComponent"
‚Üí _parent_node = get_parent() ‚Üí —ç—Ç–æ Area2D (Hurtbox)
‚Üí _parent_node.get_node("HealthComponent") ‚Üí –∏—â–µ—Ç –í–ù–£–¢–†–ò Area2D
‚Üí –ê HealthComponent ‚Äî –†–Ø–î–û–ú —Å Area2D, –Ω–∞ —É—Ä–æ–≤–Ω–µ CharacterBody2D

–ë–∞–≥ 4: "–û—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç"
‚Üí _parent_node as CharacterBody2D ‚Üí null (–ø–æ—Ç–æ–º—É —á—Ç–æ parent = Area2D)
```

**–†–µ—à–µ–Ω–∏–µ:** —É–ø—Ä–æ—â–∞–µ–º –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É. –°–∫—Ä–∏–ø—Ç `receive_damage` –≤–µ—à–∞–µ–º –ø—Ä—è–º–æ –Ω–∞ Area2D.

---

## –®–∞–≥ 1 ‚Äî Collision Layers (–°–ê–ú–û–ï –í–ê–ñ–ù–û–ï)

> **–ü—Ä–æ–µ–∫—Ç ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí General ‚Üí Layer Names ‚Üí 2D Physics**

–ü—Ä–æ–ø–∏—à–∏ –∏–º–µ–Ω–∞ —Å–ª–æ—ë–≤:

```
Layer 1: walls
Layer 2: player_body
Layer 3: enemy_body
Layer 4: player_attack
Layer 5: enemy_attack
Layer 6: player_hurtbox
Layer 7: enemy_hurtbox
```

**–ö—Ç–æ –Ω–∞ –∫–∞–∫–æ–º —Å–ª–æ–µ –∏ —á—Ç–æ –≤–∏–¥–∏—Ç:**

```
–ù–æ–¥–∞                    ‚îÇ Layer (—è –µ—Å—Ç—å) ‚îÇ Mask (—è –≤–∏–∂—É)
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
Player (CharacterBody2D)‚îÇ 2              ‚îÇ 1, 3
Enemy (CharacterBody2D) ‚îÇ 3              ‚îÇ 1, 2, 3
Player AttackArea       ‚îÇ ‚Äî              ‚îÇ 7
Enemy AttackArea        ‚îÇ ‚Äî              ‚îÇ 6
Player Hurtbox          ‚îÇ 6              ‚îÇ ‚Äî
Enemy Hurtbox           ‚îÇ 7              ‚îÇ ‚Äî
```

**–ß—Ç–æ —ç—Ç–æ –¥–∞—ë—Ç:**
```
‚úÖ –ò–≥—Ä–æ–∫ —Å—Ç–∞–ª–∫–∏–≤–∞–µ—Ç—Å—è —Å–æ —Å—Ç–µ–Ω–∞–º–∏ –∏ –≤—Ä–∞–≥–∞–º–∏ (–Ω–µ –ø—Ä–æ—Ö–æ–¥–∏—Ç —Å–∫–≤–æ–∑—å)
‚úÖ –í—Ä–∞–≥–∏ —Å—Ç–∞–ª–∫–∏–≤–∞—é—Ç—Å—è –¥—Ä—É–≥ —Å –¥—Ä—É–≥–æ–º (–Ω–µ —Å—Ç–∞–∫–∞—é—Ç—Å—è)
‚úÖ –ê—Ç–∞–∫–∞ –∏–≥—Ä–æ–∫–∞ –±—å—ë—Ç –¢–û–õ–¨–ö–û –≤—Ä–∞–≥–æ–≤
‚úÖ –ê—Ç–∞–∫–∞ –≤—Ä–∞–≥–∞ –±—å—ë—Ç –¢–û–õ–¨–ö–û –∏–≥—Ä–æ–∫–∞
‚úÖ –ù–µ—Ç friendly fire
```

---

## –®–∞–≥ 2 ‚Äî Input Map

> **–ü—Ä–æ–µ–∫—Ç ‚Üí –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø—Ä–æ–µ–∫—Ç–∞ ‚Üí Input Map**

–î–æ–±–∞–≤—å –¥–µ–π—Å—Ç–≤–∏—è:

```
move_up     ‚Üí W
move_down   ‚Üí S
move_left   ‚Üí A
move_right  ‚Üí D
attack      ‚Üí Left Mouse Button (–õ–ö–ú)
```

---

## –®–∞–≥ 3 ‚Äî HealthComponent (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)

`scripts/components/health_component.gd`:

```gdscript
extends Node
class_name HealthComponent

signal health_changed(current: int, maximum: int)
signal died

@export var max_health: int = 100
var current_health: int


func _ready() -> void:
    current_health = max_health


func take_damage(amount: int) -> void:
    current_health = max(0, current_health - amount)
    health_changed.emit(current_health, max_health)
    print("%s –ø–æ–ª—É—á–∏–ª %d —É—Ä–æ–Ω–∞. HP: %d/%d" % [get_parent().name, amount, current_health, max_health])
    if current_health <= 0:
        died.emit()


func heal(amount: int) -> void:
    current_health = min(max_health, current_health + amount)
    health_changed.emit(current_health, max_health)


func is_alive() -> bool:
    return current_health > 0
```

---

## –®–∞–≥ 4 ‚Äî –ù–æ–≤—ã–π Hurtbox (–ó–ê–ú–ï–ù–ê —Å—Ç–∞—Ä—ã—Ö –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤)

> –£–¥–∞–ª–∏ `HitboxComponent.gd` –∏ `HurtboxComponent.gd`. –í–º–µ—Å—Ç–æ –Ω–∏—Ö ‚Äî –æ–¥–∏–Ω –ø—Ä–æ—Å—Ç–æ–π —Å–∫—Ä–∏–ø—Ç **–Ω–∞ —Å–∞–º–æ–π Area2D**.

`scripts/components/hurtbox.gd`:

```gdscript
extends Area2D
class_name Hurtbox
## Hurtbox ‚Äî –∑–æ–Ω–∞ –ø–æ–ª—É—á–µ–Ω–∏—è —É—Ä–æ–Ω–∞
## –í–µ—à–∞–µ—Ç—Å—è –ù–ê–ü–†–Ø–ú–£–Æ –Ω–∞ Area2D
## –†–æ–¥–∏—Ç–µ–ª—å (get_parent()) –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å CharacterBody2D

signal damage_received(amount: int, knockback: Vector2)

@export var invincibility_time: float = 0.3

var _is_invincible: bool = false


## –ü–æ–ª—É—á–∏—Ç—å —É—Ä–æ–Ω ‚Äî –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è –∞—Ç–∞–∫—É—é—â–µ–π —Å—Ç–æ—Ä–æ–Ω–æ–π
func receive_damage(amount: int, knockback_force: float, attacker_position: Vector2) -> void:
    if _is_invincible:
        return

    var entity = get_parent()

    # –ù–∞–Ω–æ—Å–∏–º —É—Ä–æ–Ω —á–µ—Ä–µ–∑ HealthComponent
    var health = entity.get_node_or_null("HealthComponent") as HealthComponent
    if health:
        health.take_damage(amount)

    # –°—á–∏—Ç–∞–µ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏—è
    var direction: Vector2 = (entity.global_position - attacker_position).normalized()
    if direction == Vector2.ZERO:
        direction = Vector2.RIGHT

    # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–∏–≥–Ω–∞–ª ‚Äî entity —Å–∞–º —Ä–µ—à–∏—Ç —á—Ç–æ –¥–µ–ª–∞—Ç—å
    damage_received.emit(amount, direction * knockback_force)

    # –ù–µ—É—è–∑–≤–∏–º–æ—Å—Ç—å
    _is_invincible = true

    # –ú–∏–≥–∞–Ω–∏–µ
    var tween = create_tween()
    tween.tween_property(entity, "modulate", Color(1, 0.3, 0.3), 0.05)
    tween.tween_property(entity, "modulate", Color.WHITE, 0.15)

    await get_tree().create_timer(invincibility_time).timeout
    _is_invincible = false
```

**–ü–æ—á–µ–º—É —ç—Ç–æ –ª—É—á—à–µ:**
```
–†–∞–Ω—å—à–µ: AttackArea ‚Üí area_entered ‚Üí Area2D ‚Üí ???
        area.has_method("receive_damage") = FALSE (–º–µ—Ç–æ–¥ –Ω–∞ –¥–æ—á–µ—Ä–Ω–µ–º Node)

–¢–µ–ø–µ—Ä—å: AttackArea ‚Üí area_entered ‚Üí Area2D (Hurtbox)
        area.has_method("receive_damage") = TRUE (–º–µ—Ç–æ–¥ –Ω–∞ —Å–∞–º–æ–π Area2D)
```

---

## –®–∞–≥ 5 ‚Äî –ò–≥—Ä–æ–∫ (–ø–æ–ª–Ω–∞—è –ø–µ—Ä–µ–¥–µ–ª–∫–∞)

### –î–µ—Ä–µ–≤–æ —Å—Ü–µ–Ω—ã `scenes/player/player.tscn`

–°—Ç—Ä–æ–π –≤ —Ä–µ–¥–∞–∫—Ç–æ—Ä–µ **–ø–æ –æ–¥–Ω–æ–π –Ω–æ–¥–µ**:

```
Player (CharacterBody2D)
‚îÇ   ‚Üí Layer: 2 (player_body)
‚îÇ   ‚Üí Mask: 1, 3 (walls, enemy_body)
‚îÇ
‚îú‚îÄ‚îÄ BodyCollision (CollisionShape2D)
‚îÇ   ‚Üí Shape: CircleShape2D, radius = 14
‚îÇ
‚îú‚îÄ‚îÄ HealthComponent (Node)
‚îÇ   ‚Üí Script: health_component.gd
‚îÇ   ‚Üí max_health: 100
‚îÇ
‚îú‚îÄ‚îÄ Visuals (Node2D)
‚îÇ   ‚îî‚îÄ‚îÄ Body (ColorRect)
‚îÇ       ‚Üí Position: (-16, -16)     ‚Üê —á—Ç–æ–±—ã —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å
‚îÇ       ‚Üí Size: (32, 32)
‚îÇ       ‚Üí Color: —Å–∏–Ω–∏–π
‚îÇ
‚îú‚îÄ‚îÄ WeaponPivot (Node2D)            ‚Üê –∫—Ä—É—Ç–∏—Ç—Å—è –∑–∞ –º—ã—à—å—é
‚îÇ   ‚Üí Position: (0, 0)
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ WeaponSprite (ColorRect)    ‚Üê –≤–∏–∑—É–∞–ª –æ—Ä—É–∂–∏—è
‚îÇ   ‚îÇ   ‚Üí Position: (16, -3)
‚îÇ   ‚îÇ   ‚Üí Size: (22, 6)
‚îÇ   ‚îÇ   ‚Üí Color: —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ AttackArea (Area2D)         ‚Üê –∑–æ–Ω–∞ —É–¥–∞—Ä–∞
‚îÇ       ‚Üí Monitoring: false         ‚Üê –í–´–ö–õ–Æ–ß–ï–ù–û –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é!
‚îÇ       ‚Üí Monitorable: false
‚îÇ       ‚Üí Layer: –Ω–∏—á–µ–≥–æ
‚îÇ       ‚Üí Mask: 7 (enemy_hurtbox)
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ AttackShape (CollisionShape2D)
‚îÇ           ‚Üí Shape: RectangleShape2D (28 x 16)
‚îÇ           ‚Üí Position: (26, 0)     ‚Üê –≤–ø–µ—Ä–µ–¥–∏ –∏–≥—Ä–æ–∫–∞
‚îÇ
‚îú‚îÄ‚îÄ Hurtbox (Area2D)                ‚Üê –°–ö–†–ò–ü–¢: hurtbox.gd
‚îÇ   ‚Üí Script: hurtbox.gd
‚îÇ   ‚Üí Monitoring: false
‚îÇ   ‚Üí Monitorable: true
‚îÇ   ‚Üí Layer: 6 (player_hurtbox)
‚îÇ   ‚Üí Mask: –Ω–∏—á–µ–≥–æ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ HurtboxShape (CollisionShape2D)
‚îÇ       ‚Üí Shape: CircleShape2D, radius = 14
‚îÇ
‚îî‚îÄ‚îÄ HPBar (ProgressBar)
    ‚Üí Position: (-18, -28)
    ‚Üí Size: (36, 5)
    ‚Üí Show Percentage: off
    ‚Üí Min Value: 0, Max Value: 100
```

**–í–∏–∑—É–∞–ª—å–Ω–æ —ç—Ç–æ –≤—ã–≥–ª—è–¥–∏—Ç —Ç–∞–∫:**

```
         HP –±–∞—Ä
        [‚ñà‚ñà‚ñà‚ñà‚ñà‚ñà]
        ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
        ‚îÇ      ‚îÇ‚ïê‚ïê‚ïê‚ñ∂  ‚Üê –û—Ä—É–∂–∏–µ (–ø–æ–≤–æ—Ä–∞—á–∏–≤–∞–µ—Ç—Å—è –∑–∞ –º—ã—à—å—é)
        ‚îÇ –¢–µ–ª–æ ‚îÇ      ‚Üê –ó–æ–Ω–∞ –∞—Ç–∞–∫–∏ (–ø–µ—Ä–µ–¥ –æ—Ä—É–∂–∏–µ–º)
        ‚îÇ      ‚îÇ
        ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### –°–∫—Ä–∏–ø—Ç `scripts/player/player.gd`

```gdscript
extends CharacterBody2D
## Player.gd ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ, –ø–æ–≤–æ—Ä–æ—Ç –∑–∞ –º—ã—à—å—é, –∞—Ç–∞–∫–∞ –º–µ—á–æ–º

@onready var health_component: HealthComponent = $HealthComponent
@onready var weapon_pivot: Node2D = $WeaponPivot
@onready var weapon_sprite: ColorRect = $WeaponPivot/WeaponSprite
@onready var attack_area: Area2D = $WeaponPivot/AttackArea
@onready var body_sprite: ColorRect = $Visuals/Body
@onready var hurtbox: Hurtbox = $Hurtbox
@onready var hp_bar: ProgressBar = $HPBar

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
@export var speed: float = 200.0
@export var attack_damage: int = 25
@export var attack_knockback: float = 250.0
@export var attack_duration: float = 0.15
@export var attack_cooldown: float = 0.4

# --- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
var _is_attacking: bool = false
var _knockback_velocity: Vector2 = Vector2.ZERO

# --- –¶–≤–µ—Ç–∞ –æ—Ä—É–∂–∏—è ---
var _weapon_color_idle: Color = Color.LIGHT_GRAY
var _weapon_color_attack: Color = Color.WHITE


func _ready() -> void:
    add_to_group("player")

    # –ü–æ–¥–∫–ª—é—á–∞–µ–º —Å–∏–≥–Ω–∞–ª—ã
    health_component.died.connect(_on_died)
    health_component.health_changed.connect(_on_health_changed)
    hurtbox.damage_received.connect(_on_damage_received)
    attack_area.area_entered.connect(_on_attack_hit)

    # –ê—Ç–∞–∫–∞ –≤—ã–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    attack_area.monitoring = false

    # HP –±–∞—Ä
    hp_bar.max_value = health_component.max_health
    hp_bar.value = health_component.current_health

    # –¶–≤–µ—Ç –æ—Ä—É–∂–∏—è
    weapon_sprite.color = _weapon_color_idle


func _physics_process(delta: float) -> void:
    if not health_component.is_alive():
        return

    # --- –î–≤–∏–∂–µ–Ω–∏–µ ---
    var input_dir: Vector2 = Input.get_vector("move_left", "move_right", "move_up", "move_down")
    var move_velocity: Vector2 = input_dir.normalized() * speed

    # –û—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –∑–∞—Ç—É—Ö–∞–µ—Ç
    _knockback_velocity = _knockback_velocity.move_toward(Vector2.ZERO, 800.0 * delta)

    # –ò—Ç–æ–≥–æ–≤–∞—è —Å–∫–æ—Ä–æ—Å—Ç—å = –¥–≤–∏–∂–µ–Ω–∏–µ + –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ
    velocity = move_velocity + _knockback_velocity
    move_and_slide()

    # --- –ü–æ–≤–æ—Ä–æ—Ç –æ—Ä—É–∂–∏—è –∑–∞ –º—ã—à—å—é ---
    var mouse_pos: Vector2 = get_global_mouse_position()
    weapon_pivot.rotation = (mouse_pos - global_position).angle()

    # --- –ê—Ç–∞–∫–∞ ---
    if Input.is_action_just_pressed("attack") and not _is_attacking:
        _perform_attack()


## –í—ã–ø–æ–ª–Ω–∏—Ç—å –∞—Ç–∞–∫—É –º–µ—á–æ–º
func _perform_attack() -> void:
    _is_attacking = true

    # –í–∫–ª—é—á–∞–µ–º –∑–æ–Ω—É —É—Ä–æ–Ω–∞
    attack_area.monitoring = true
    weapon_sprite.color = _weapon_color_attack

    # –ù–µ–±–æ–ª—å—à–æ–µ "–≤—ã–¥–≤–∏–∂–µ–Ω–∏–µ" –æ—Ä—É–∂–∏—è –≤–ø–µ—Ä—ë–¥
    var tween := create_tween()
    tween.tween_property(weapon_sprite, "position:x", 22.0, 0.05)
    tween.tween_property(weapon_sprite, "position:x", 16.0, 0.1)

    await get_tree().create_timer(attack_duration).timeout

    # –í—ã–∫–ª—é—á–∞–µ–º –∑–æ–Ω—É —É—Ä–æ–Ω–∞
    attack_area.monitoring = false
    weapon_sprite.color = _weapon_color_idle

    # –ö—É–ª–¥–∞—É–Ω –¥–æ —Å–ª–µ–¥—É—é—â–µ–π –∞—Ç–∞–∫–∏
    await get_tree().create_timer(attack_cooldown - attack_duration).timeout
    _is_attacking = false


## –ê—Ç–∞–∫–∞ –ø–æ–ø–∞–ª–∞ –ø–æ –≤—Ä–∞–∂–µ—Å–∫–æ–º—É hurtbox
func _on_attack_hit(area: Area2D) -> void:
    if area.has_method("receive_damage"):
        area.receive_damage(attack_damage, attack_knockback, global_position)
        print("–ü–æ–ø–∞–ª –ø–æ: ", area.get_parent().name)


## –ü–æ–ª—É—á–∏–ª —É—Ä–æ–Ω
func _on_damage_received(_amount: int, knockback: Vector2) -> void:
    _knockback_velocity = knockback


## HP –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
func _on_health_changed(current: int, maximum: int) -> void:
    hp_bar.max_value = maximum
    hp_bar.value = current


## –°–º–µ—Ä—Ç—å
func _on_died() -> void:
    set_physics_process(false)
    modulate = Color(0.5, 0.5, 0.5, 0.5)
    print("–ò–≥—Ä–æ–∫ –ø–æ–≥–∏–±!")
```

---

## –®–∞–≥ 6 ‚Äî –°–ª–∏–∑—å (–≤—Ä–∞–≥)

### –î–µ—Ä–µ–≤–æ —Å—Ü–µ–Ω—ã `scenes/enemies/slime.tscn`

```
Slime (CharacterBody2D)
‚îÇ   ‚Üí Layer: 3 (enemy_body)
‚îÇ   ‚Üí Mask: 1, 2, 3 (walls, player_body, enemy_body)
‚îÇ
‚îú‚îÄ‚îÄ BodyCollision (CollisionShape2D)
‚îÇ   ‚Üí Shape: CircleShape2D, radius = 12
‚îÇ
‚îú‚îÄ‚îÄ HealthComponent (Node)
‚îÇ   ‚Üí Script: health_component.gd
‚îÇ   ‚Üí max_health: 40
‚îÇ
‚îú‚îÄ‚îÄ Visuals (Node2D)
‚îÇ   ‚îî‚îÄ‚îÄ Body (ColorRect)
‚îÇ       ‚Üí Position: (-12, -12)
‚îÇ       ‚Üí Size: (24, 24)
‚îÇ       ‚Üí Color: –∑–µ–ª—ë–Ω—ã–π (#44cc44)
‚îÇ
‚îú‚îÄ‚îÄ AttackArea (Area2D)             ‚Üê –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —É—Ä–æ–Ω
‚îÇ   ‚Üí Monitoring: true
‚îÇ   ‚Üí Monitorable: false
‚îÇ   ‚Üí Layer: –Ω–∏—á–µ–≥–æ
‚îÇ   ‚Üí Mask: 6 (player_hurtbox)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ AttackShape (CollisionShape2D)
‚îÇ       ‚Üí Shape: CircleShape2D, radius = 16
‚îÇ
‚îú‚îÄ‚îÄ Hurtbox (Area2D)                ‚Üê –°–ö–†–ò–ü–¢: hurtbox.gd
‚îÇ   ‚Üí Script: hurtbox.gd
‚îÇ   ‚Üí Monitoring: false
‚îÇ   ‚Üí Monitorable: true
‚îÇ   ‚Üí Layer: 7 (enemy_hurtbox)
‚îÇ   ‚Üí Mask: –Ω–∏—á–µ–≥–æ
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ HurtboxShape (CollisionShape2D)
‚îÇ       ‚Üí Shape: CircleShape2D, radius = 12
‚îÇ
‚îî‚îÄ‚îÄ HPBar (ProgressBar)
    ‚Üí Position: (-14, -22)
    ‚Üí Size: (28, 4)
    ‚Üí Show Percentage: off
```

### –°–∫—Ä–∏–ø—Ç `scripts/enemies/slime.gd`

```gdscript
extends CharacterBody2D
## Slime.gd ‚Äî –ø—Ä–æ—Å—Ç–æ–π –≤—Ä–∞–≥, –∏–¥—ë—Ç –∫ –∏–≥—Ä–æ–∫—É –∏ –±—å—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–º

@onready var health_component: HealthComponent = $HealthComponent
@onready var attack_area: Area2D = $AttackArea
@onready var body_sprite: ColorRect = $Visuals/Body
@onready var hurtbox: Hurtbox = $Hurtbox
@onready var hp_bar: ProgressBar = $HPBar

# --- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ ---
@export var speed: float = 70.0
@export var contact_damage: int = 10
@export var attack_cooldown: float = 1.0
@export var stop_distance: float = 20.0          # –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –∏–¥—Ç–∏ –Ω–∞ —ç—Ç–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏
@export var detection_range: float = 250.0        # –≤–∏–¥–∏—Ç –∏–≥—Ä–æ–∫–∞ –Ω–∞ —ç—Ç–æ–º —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–∏

# --- –í–Ω—É—Ç—Ä–µ–Ω–Ω–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ ---
var _target: CharacterBody2D = null
var _knockback_velocity: Vector2 = Vector2.ZERO
var _attack_timer: float = 0.0

# --- –¶–≤–µ—Ç–∞ ---
var _color_normal: Color = Color("44cc44")
var _color_angry: Color = Color("ff6644")


func _ready() -> void:
    add_to_group("enemy")

    health_component.died.connect(_on_died)
    health_component.health_changed.connect(_on_health_changed)
    hurtbox.damage_received.connect(_on_damage_received)

    # HP –±–∞—Ä
    hp_bar.max_value = health_component.max_health
    hp_bar.value = health_component.current_health

    body_sprite.color = _color_normal


func _physics_process(delta: float) -> void:
    if not health_component.is_alive():
        return

    # --- –ü–æ–∏—Å–∫ —Ü–µ–ª–∏ ---
    _find_target()

    # --- –î–≤–∏–∂–µ–Ω–∏–µ ---
    var move_velocity: Vector2 = Vector2.ZERO

    if _target and is_instance_valid(_target):
        var distance: float = global_position.distance_to(_target.global_position)

        if distance <= detection_range:
            body_sprite.color = _color_angry     # –ó–∞–º–µ—Ç–∏–ª –∏–≥—Ä–æ–∫–∞!

            if distance > stop_distance:
                # –ò–¥—ë–º –∫ –∏–≥—Ä–æ–∫—É
                var direction: Vector2 = (_target.global_position - global_position).normalized()
                move_velocity = direction * speed
            else:
                # –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –±–ª–∏–∑–∫–æ ‚Äî —Å—Ç–æ–∏–º –∏ –±—å—ë–º
                move_velocity = Vector2.ZERO
        else:
            body_sprite.color = _color_normal    # –ù–µ –≤–∏–¥–∏—Ç
    else:
        body_sprite.color = _color_normal

    # –û—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ –∑–∞—Ç—É—Ö–∞–µ—Ç
    _knockback_velocity = _knockback_velocity.move_toward(Vector2.ZERO, 600.0 * delta)

    velocity = move_velocity + _knockback_velocity
    move_and_slide()

    # --- –ö–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —É—Ä–æ–Ω ---
    _attack_timer -= delta
    if _attack_timer <= 0.0:
        _try_contact_damage()


## –ù–∞–π—Ç–∏ –±–ª–∏–∂–∞–π—à–µ–≥–æ –∏–≥—Ä–æ–∫–∞
func _find_target() -> void:
    if _target and is_instance_valid(_target):
        return  # –£–∂–µ –µ—Å—Ç—å —Ü–µ–ª—å

    var players: Array = get_tree().get_nodes_in_group("player")
    var min_dist: float = INF
    for p in players:
        var dist: float = global_position.distance_to(p.global_position)
        if dist < min_dist:
            min_dist = dist
            _target = p


## –ü–æ–ø—ã—Ç–∫–∞ –Ω–∞–Ω–µ—Å—Ç–∏ –∫–æ–Ω—Ç–∞–∫—Ç–Ω—ã–π —É—Ä–æ–Ω
func _try_contact_damage() -> void:
    var areas: Array = attack_area.get_overlapping_areas()
    for area in areas:
        if area.has_method("receive_damage"):
            area.receive_damage(contact_damage, 150.0, global_position)
            _attack_timer = attack_cooldown
            print("%s –±—å—ë—Ç –∏–≥—Ä–æ–∫–∞ –Ω–∞ %d —É—Ä–æ–Ω–∞!" % [name, contact_damage])
            return


## –ü–æ–ª—É—á–∏–ª —É—Ä–æ–Ω ‚Äî –æ—Ç–±—Ä–∞—Å—ã–≤–∞–Ω–∏–µ
func _on_damage_received(_amount: int, knockback: Vector2) -> void:
    _knockback_velocity = knockback


## HP –∏–∑–º–µ–Ω–∏–ª–æ—Å—å
func _on_health_changed(current: int, maximum: int) -> void:
    hp_bar.max_value = maximum
    hp_bar.value = current


## –°–º–µ—Ä—Ç—å
func _on_died() -> void:
    set_physics_process(false)

    # –ê–Ω–∏–º–∞—Ü–∏—è —Å–º–µ—Ä—Ç–∏
    var tween: Tween = create_tween()
    tween.tween_property(self, "modulate:a", 0.0, 0.4)
    tween.tween_callback(queue_free)

    print("%s —É–±–∏—Ç!" % name)
```

---

## –®–∞–≥ 7 ‚Äî –û–±–Ω–æ–≤–ª—ë–Ω–Ω—ã–π game.gd

```gdscript
extends Node2D
## Game ‚Äî —Ç–µ—Å—Ç–æ–≤–∞—è —Å—Ü–µ–Ω–∞

@onready var info_label: Label = $CanvasLayer/InfoLabel
@onready var player_container: Node2D = $PlayerContainer
@onready var enemy_container: Node2D = $EnemyContainer


func _ready() -> void:
    var class_data := GameManager.get_selected_class_data()
    info_label.text = "–ö–ª–∞—Å—Å: %s | WASD ‚Äî –¥–≤–∏–∂–µ–Ω–∏–µ | –õ–ö–ú ‚Äî –∞—Ç–∞–∫–∞ | ESC ‚Äî –º–µ–Ω—é" % class_data["name"]

    _spawn_player(class_data)
    _spawn_enemies()


func _spawn_player(class_data: Dictionary) -> void:
    var player_scene: PackedScene = load("res://scenes/player/player.tscn")
    var player: CharacterBody2D = player_scene.instantiate()

    player.position = Vector2(200, 300)
    player_container.add_child(player)

    # –ü—Ä–∏–º–µ–Ω—è–µ–º —Å—Ç–∞—Ç—ã –∫–ª–∞—Å—Å–∞
    var health: HealthComponent = player.get_node("HealthComponent")
    health.max_health = class_data["stats"]["hp"]
    health.current_health = class_data["stats"]["hp"]
    player.speed = class_data["stats"]["speed"]
    player.attack_damage = class_data["stats"]["damage"]

    # –¶–≤–µ—Ç —Ç–µ–ª–∞
    player.get_node("Visuals/Body").color = class_data["color"]


func _spawn_enemies() -> void:
    var slime_scene: PackedScene = load("res://scenes/enemies/slime.tscn")

    var positions := [
        Vector2(500, 200),
        Vector2(600, 400),
        Vector2(350, 500),
    ]

    for pos in positions:
        var slime: CharacterBody2D = slime_scene.instantiate()
        slime.position = pos
        enemy_container.add_child(slime)


func _input(event: InputEvent) -> void:
    if event.is_action_pressed("ui_cancel"):
        GameManager.go_to_menu()
```

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç ‚Äî –ø—Ä–æ–≤–µ—Ä—å –ø–æ –ø–æ—Ä—è–¥–∫—É

```
–ù–∞—Å—Ç—Ä–æ–π–∫–∞:
  [ ] Collision layers –ø—Ä–æ–ø–∏—Å–∞–Ω—ã (7 —Å–ª–æ—ë–≤)
  [ ] Input Map: move_up/down/left/right + attack (–õ–ö–ú)
  [ ] GameManager –≤ –∞–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–µ

–§–∞–π–ª—ã:
  [ ] scripts/components/health_component.gd
  [ ] scripts/components/hurtbox.gd         ‚Üê –ù–û–í–´–ô
  [ ] scripts/player/player.gd              ‚Üê –ü–ï–†–ï–ü–ò–°–ê–ù
  [ ] scripts/enemies/slime.gd              ‚Üê –ù–û–í–´–ô
  [ ] –°—Ç–∞—Ä—ã–µ hitbox_component.gd –∏ hurtbox_component.gd ‚Äî –£–î–ê–õ–ò–¢–¨

–°—Ü–µ–Ω—ã (collision layers!):
  [ ] player.tscn ‚Äî Layer 2, Mask 1,3
      [ ] AttackArea ‚Äî Mask 7, monitoring OFF
      [ ] Hurtbox ‚Äî Layer 6, —Å–∫—Ä–∏–ø—Ç hurtbox.gd
  [ ] slime.tscn ‚Äî Layer 3, Mask 1,2,3
      [ ] AttackArea ‚Äî Mask 6, monitoring ON
      [ ] Hurtbox ‚Äî Layer 7, —Å–∫—Ä–∏–ø—Ç hurtbox.gd

–¢–µ—Å—Ç–∏—Ä—É–π:
  [ ] –ò–≥—Ä–æ–∫ –¥–≤–∏–≥–∞–µ—Ç—Å—è WASD
  [ ] –û—Ä—É–∂–∏–µ –∫—Ä—É—Ç–∏—Ç—Å—è –∑–∞ –º—ã—à—å—é
  [ ] –õ–ö–ú ‚Äî –æ—Ä—É–∂–∏–µ –º–∏–≥–∞–µ—Ç, –∑–æ–Ω–∞ –∞—Ç–∞–∫–∏ –ø–æ—è–≤–ª—è–µ—Ç—Å—è
  [ ] –£–¥–∞—Ä –ø–æ —Å–ª–∏–∑–∏ ‚Äî —Å–ª–∏–∑—å —Ç–µ—Ä—è–µ—Ç HP + –æ—Ç–ª–µ—Ç–∞–µ—Ç
  [ ] HP –±–∞—Ä —Å–ª–∏–∑–∏ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
  [ ] –°–ª–∏–∑—å —É–º–∏—Ä–∞–µ—Ç –∏ –∏—Å—á–µ–∑–∞–µ—Ç
  [ ] –°–ª–∏–∑—å –∏–¥—ë—Ç –∫ –∏–≥—Ä–æ–∫—É –∏ –±—å—ë—Ç –∫–æ–Ω—Ç–∞–∫—Ç–æ–º
  [ ] –ò–≥—Ä–æ–∫ –ø–æ–ª—É—á–∞–µ—Ç —É—Ä–æ–Ω + –º–∏–≥–∞–µ—Ç –∫—Ä–∞—Å–Ω—ã–º
  [ ] HP –±–∞—Ä –∏–≥—Ä–æ–∫–∞ —É–º–µ–Ω—å—à–∞–µ—Ç—Å—è
  [ ] –í—Ä–∞–≥–∏ –ù–ï –ø—Ä–æ—Ö–æ–¥—è—Ç –¥—Ä—É–≥ —Å–∫–≤–æ–∑—å –¥—Ä—É–≥–∞
  [ ] –í—Ä–∞–≥–∏ –ù–ï –ø—Ä–æ—Ö–æ–¥—è—Ç —Å–∫–≤–æ–∑—å –∏–≥—Ä–æ–∫–∞
```

---

## üìã –ß—Ç–æ –¥–µ–ª–∞—Ç—å –¥–∞–ª—å—à–µ (–ø–æ—Å–ª–µ —Ç–æ–≥–æ –∫–∞–∫ –≤—Å—ë –∑–∞—Ä–∞–±–æ—Ç–∞–µ—Ç)

```
[ ] –û—Å—Ç–∞–ª—å–Ω—ã–µ 3 –∫–ª–∞—Å—Å–∞ (–ª—É—á–Ω–∏–∫, –º–∞–≥, –ø–∞–ª–∞–¥–∏–Ω)
[ ] –ë–æ–ª—å—à–µ —Ç–∏–ø–æ–≤ –≤—Ä–∞–≥–æ–≤ (—Å–∫–µ–ª–µ—Ç, –ª–µ—Ç—É—á–∞—è –º—ã—à—å)
[ ] –õ—É—Ç (–∑–µ–ª—å—è, –æ—Ä—É–∂–∏–µ)
[ ] –ë–æ—Å—Å
```

–°–¥–µ–ª–∞–π —ç—Ç–æ—Ç —á–µ–∫–ª–∏—Å—Ç, –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π, –∏ –ø–∏—à–∏ ‚Äî –ø–æ–π–¥—ë–º –¥–∞–ª—å—à–µ –∫ –æ—Å—Ç–∞–ª—å–Ω—ã–º –∫–ª–∞—Å—Å–∞–º!