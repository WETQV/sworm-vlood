

# План MVP для Roguelike на Godot 4

## 🎯 Сначала — определим рамки MVP

MVP — это **минимальная играбельная версия**. Не идеальная, а та, в которую уже можно сесть и поиграть.

---

## 📋 MVP включает:

```
✅ Один тип подземелья (dungeon)
✅ 4 играбельных класса с базовыми механиками
✅ Процедурная генерация комнат и коридоров
✅ 1 босс в конце этажа (арена и динамический спавн готовы)
✅ Базовая архитектура (HP, коллизии, камера)
✅ Swarm AI v2 (система угроз, отряды, уклонение от AoE)
✅ 3-5 типов врагов (базовый Slime и Boss готовы)
✅ Мультиплеер (в планах)
✅ Простой лут (в планах)
```

---

## 🏗️ Разбивка на этапы (спринты)

### Этап 0 — Фундамент (1-2 недели)

**Цель:** игрок двигается и атакует в пустой комнате

```
Задачи:
├── Настроить проект Godot 4
├── Выбрать и настроить тайлсет (можно временные квадраты)
├── Сделать базового персонажа (CharacterBody2D)
│   ├── Движение в 8 направлений
│   ├── Коллизии
│   └── Простая анимация (idle / walk)
├── Система атаки (хотя бы для мечника)
│   └── Hitbox / Hurtbox система
└── Простой враг, который ходит к игроку и бьёт
```

**Архитектура персонажа:**
```
CharacterBody2D (Player)
├── CollisionShape2D
├── AnimatedSprite2D
├── HurtboxComponent (Area2D)  — получает урон
├── HitboxComponent (Area2D)   — наносит урон
├── HealthComponent (Node)     — HP логика
└── StateMachine (Node)        — состояния
```

---

### Этап 1 — Процедурная генерация (Завершено ✅)

**Цель:** каждый запуск — новая карта

```
Подход: "Комнаты + коридоры" (самый классический)

Алгоритм:
1. Создать пул готовых комнат (10-15 штук) в редакторе
2. Разместить комнаты случайно на сетке (без пересечений)
3. Соединить коридорами (MST — минимальное остовное дерево)
4. Одна комната = старт, одна = босс, остальные = бой/лут
```

```
Структура этажа:
┌──────┐     ┌──────┐     ┌──────┐
│START │─────│FIGHT │─────│CHEST │
└──────┘     └──┬───┘     └──────┘
                │
            ┌───┴──┐     ┌──────┐
            │FIGHT │─────│ BOSS │
            └──────┘     └──────┘
```

**Совет:** сначала сделайте генерацию БЕЗ мультиплеера. Убедитесь, что работает.

---

### Этап 2 — Четыре класса (2 недели)

**Цель:** каждый класс уникально играется

```
Базовый класс Player (общий):
├── HP, скорость, урон
├── Обычная атака
├── Особая способность (кулдаун)
└── Пассивный бонус

⚔️ МЕЧНИК (Warrior)
├── Обычная: удар мечом (средний урон, средняя дальность)
├── Особая: круговой удар (AoE вокруг себя)
├── Пассивка: +20% HP
└── Роль: ближний бой, урон

🏹 ЛУЧНИК (Ranger)
├── Обычная: выстрел стрелой (снаряд летит прямо)
├── Особая: веер из 5 стрел
├── Пассивка: +30% скорость передвижения
└── Роль: дальний бой, мобильность

🔮 МАГ (Mage)
├── Обычная: огненный шар (снаряд с AoE при попадании)
├── Особая: метеорит (AoE по зоне, задержка)
├── Пассивка: +30% урон, -20% HP
└── Роль: стеклянная пушка

🛡️ ПАЛАДИН (Paladin)
├── Обычная: удар щитом (малый урон, отбрасывание)
├── Особая: купол защиты (щит для всех рядом)
├── Пассивка: +40% HP, -15% скорость
└── Роль: танк, поддержка
```

**Баланс для MVP (числа):**
```
             HP    Урон   Скорость   Кулдаун способности
Мечник      120    25     200        5 сек
Лучник       80    20     260        6 сек
Маг          70    35     200        8 сек
Паладин     150    15     170        10 сек
```

---

### Этап 3 — Враги и бой (В процессе / Ядро ИИ готово ✅)

**Цель:** в комнатах есть разнообразные враги с умным поведением

```
Враги и ИИ:
├── Swarm AI v2 — общая система управления роями врагов (SwarmManager)
├── Система угроз — враги реагируют на убийства и опасность
├── Роли (Stalker, Skirmisher, Tank) — адаптивное поведение
├── Уклонение от AoE — враги видят Fireball или удары Паладина
├── Слайм      — базовый враг, идёт к игроку, бьёт в упор
├── Скелет     — ходит, бьёт мечом (в планах)
├── БОСС: Слайм — огромный, медленный, больно бьёт (готов)
└── БОСС: Некромант (финальный)
```

**AI врагов (Swarm AI v2):**
```gdscript
# Враги используют децентрализованную систему весов
# 1. Приоритет игрока (Threat)
# 2. Уклонение от опасных зон (Danger Zones)
# 3. Удержание дистанции (Roles)
```

---

### Этап 4 — Мультиплеер по локалке (2-3 недели)

> ⚠️ **Это самый сложный этап.** Начинать его стоит после того, как одиночная игра работает.

**Подход: Host-Client через ENet (встроенный в Godot 4)**

```
Архитектура:
├── Хост = сервер + клиент (он играет и управляет миром)
├── Остальные = клиенты
├── Генерация мира — ТОЛЬКО на хосте (seed передаётся)
├── Враги управляются ТОЛЬКО хостом
└── Каждый игрок управляет ТОЛЬКО своим персонажем
```

```
Что синхронизируем:
├── Позиции игроков          → MultiplayerSynchronizer
├── Позиции врагов           → MultiplayerSynchronizer
├── Атаки / способности      → RPC вызовы
├── HP игроков и врагов      → Authority на хосте
├── Генерация карты          → Seed (одно число)
└── Переход между этажами    → RPC от хоста
```

**Минимальный сетевой код:**
```gdscript
# Лобби (создание / подключение)
func host_game():
    var peer = ENetMultiplayerPeer.new()
    peer.create_server(7000, 4)  # порт, макс игроков
    multiplayer.multiplayer_peer = peer

func join_game(ip: String):
    var peer = ENetMultiplayerPeer.new()
    peer.create_client(ip, 7000)
    multiplayer.multiplayer_peer = peer
```

```
Структура сцены игрока для сети:
Player (CharacterBody2D)
├── MultiplayerSpawner
├── MultiplayerSynchronizer
│   └── sync: position, animation_state
├── InputComponent  ← работает ТОЛЬКО у владельца
└── всё остальное
```

---

### Этап 5 — Лут и прогрессия (1 неделя)

```
Предметы для MVP:
├── Зелье здоровья (восстанавливает 30% HP)
├── Зелье скорости (ускорение на 10 сек)
├── Меч +урон (мечник/паладин)
├── Лук +урон (лучник)
├── Посох +урон (маг)
└── Монеты (пока просто счётчик, на будущее)

Дроп:
├── Враг → 30% шанс зелья, 5% оружие
├── Сундук в комнате → гарантированный предмет
└── Босс → лучшее оружие + зелья
```

---

### Этап 6 — UI и Полировка (В процессе)

```
✅ Главное меню (Играть / Хост / Подключиться)
✅ Меню настроек (Звук, Видео, Управление, Сеть)
✅ Сохранение конфигураций в `user://settings.cfg`
├── Экран выбора класса
├── HUD (HP бар, кулдаун способности, этаж)
├── Экран смерти / победы
├── Базовые звуки (удар, смерть, подбор предмета)
├── Камера (следит за игроком, не выходит за карту)
└── Минимальные VFX (мигание при уроне, частицы смерти)
```

---

## 📁 Рекомендуемая структура проекта

```
res://
├── scenes/
│   ├── player/
│   │   ├── player.tscn          # базовая сцена
│   │   ├── warrior.tscn         # наследуется
│   │   ├── ranger.tscn
│   │   ├── mage.tscn
│   │   └── paladin.tscn
│   ├── enemies/
│   │   ├── base_enemy.tscn
│   │   ├── slime.tscn
│   │   └── ...
│   ├── levels/
│   │   ├── dungeon_generator.tscn
│   │   └── rooms/
│   │       ├── room_small_01.tscn
│   │       ├── room_large_01.tscn
│   │       └── ...
│   ├── ui/
│   │   ├── main_menu.tscn
│   │   ├── hud.tscn
│   │   └── class_select.tscn
│   └── items/
│       ├── health_potion.tscn
│       └── ...
├── scripts/
│   ├── components/        # переиспользуемые компоненты
│   │   ├── health_component.gd
│   │   ├── hitbox_component.gd
│   │   ├── hurtbox_component.gd
│   │   └── state_machine.gd
│   ├── autoload/
│   │   ├── game_manager.gd    # глобальное состояние
│   │   └── network_manager.gd # сетевой менеджер
│   └── resources/
│       ├── player_stats.gd    # Resource для статов
│       └── item_data.gd
├── assets/
│   ├── sprites/
│   ├── audio/
│   └── tilesets/
└── project.godot
```

---

## ⏱️ Общий таймлайн

```
Этап 0: Фундамент           │████████████████████│ 100%
Этап 1: Генерация           │████████████████████│ 100%
Этап 2: Классы              │████████████████████│ 100%
Этап 3: Враги (AI Core)     │████████████▒▒▒▒▒▒▒▒│  60%
Этап 4: Мультиплеер         │▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│   0%
Этап 5: Лут                 │▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒│   0%
Этап 6: Полировка           │██████████▒▒▒▒▒▒▒▒▒▒│  50%
                                        ИТОГО: ~45%

---

## 💡 Главные советы

```
1. СНАЧАЛА ОДИНОЧНАЯ ИГРА
   Мультиплеер добавляйте ПОСЛЕ того, как одиночная версия
   полностью работает. Иначе дебаг станет адом.

2. ИСПОЛЬЗУЙТЕ КОМПОНЕНТНУЮ АРХИТЕКТУРУ
   HealthComponent, HitboxComponent — маленькие переиспользуемые
   ноды. Враги и игроки используют одни и те же компоненты.

3. ПРОТОТИП НА КВАДРАТАХ
   Не рисуйте арт пока геймплей не работает. Цветные квадраты
   и круги — ваши лучшие друзья на старте.

4. ТЕСТИРУЙТЕ КАЖДЫЙ ДЕНЬ
   Запускайте проект после каждого изменения. Ловите баги рано.

5. GIT С ПЕРВОГО ДНЯ
   Обязательно. Без исключений.
```

По итогу используем GDscript.
Прототип на квадратах.
клава + мышь